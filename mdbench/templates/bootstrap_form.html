{% extends "base_generic.html" %}

{%block content%}
<div class="card border-0 text-left pt-4" style="background-image: url('https://mdbench.ace-net.ca/static/media/images/fig3.png'); border-radius: 0;">
    <div class="card-title">
        <h3>FILTERS</h3>
    </div>
    <div class="card-body">
    <form method='GET' action = '.'>
        <div class="row">
            <div class="col-sm-3">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input">
                            <label for="software_contains" class="form-label">Software name</label>
                            <select class="form-select mb-1 form-select-sm"  type="search" name = "software_contains"/>
                            <option value="">All</option>
                            <option value="GROMACS">GROMACS</option>                   
                            <option value="GROMACS.cuda">GROMACS.cuda</option>  
                            <option value="GROMACS.mpi">GROMACS.mpi</option>    
                            <option value="NAMD2">NAMD2</option>                    
                            <option value="NAMD2.cuda">NAMD2.cuda</option>  
                            <option value="NAMD2.cuda.ofi">NAMD2.cuda.ofi</option>                                
                            <option value="NAMD2.omp">NAMD2.omp</option>
                            <option value="NAMD2.ucx">NAMD2.ucx</option>
                            <option value="NAMD3">NAMD3</option>
                            <option value="NAMD3.cuda">NAMD3.cuda</option>
                            <option value="PMEMD">PMEMD</option>
                            <option value="PMEMD.cuda">PMEMD.cuda</option>
                            <option value="PMEMD.mpi">PMEMD.mpi</option>
                            <option value="PMEMD.cuda.MPI">PMEMD.cuda.mpi</option>
                            <option value="SANDER.QUICK.cuda">SANDER.QUICK.cuda</option>      
                            <option value="SANDER.QUICK.cuda.MPI">SANDER.QUICK.cuda.MPI</option>                                                     
                            </select> 
                        </div>            
                    </div>
                </div>
            </div>

            <div class="col-sm-2">
              <div class="form-group">
                  <div class="input-group">
                     <div class="input">
                        <label for="arch" class="form-label">Software ID</label>
                        <input class="mb-1 form-control form-control-sm" spellcheck="false" type="number" min="1" name = "software_id" placeholder="Enter ID .."/>    
                        </select>                     
                     </div>            
                  </div>
              </div>
           </div>          

            <div class="col-sm-2">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input" >
                            <label for="module_contains" class="form-label">Module</label>
                            <select class="form-select mb-1 form-select-sm" style="background-color: #b7b796;"  name = "module_contains"/>
                            <option value="">All</option>
                            <option value="amber">amber</option>     
                            <option value="ambertools">ambertools</option>                                                      
                            <option value="gromacs">gromacs</option>                   
                            <option value="namd">namd</option>  
                            <option value="namd-multicore">namd-multicore</option>    
                            <option value="namd-ofi-smp">namd-ofi-smp</option>                            
                            <option value="namd-ucx">namd-ucx</option>                    
                            <option value="binary_pack">precompiled package</option>
                            </select>                        
                        </div>            
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input" >
                              <label for="module_version" class="form-label">Module version</label>
                              <input class="mb-1 form-control form-control-sm w-50" spellcheck="false" style="background-color: #b7b796;"  type="search" name = "module_version" placeholder="Enter version .."/>
                        </div>            
                    </div>
                </div>
            </div>

              <div class="col-sm-2">
                <div class="form-group">
                  <div class="input-group">
                      <div class="input">
                      <label for="site_comtains" class="form-label">Cluster</label>
                      <select class="form-select mb-1 form-select-sm" type="search" name = "site_contains" placeholder="Narval .."/>
                      <option value="">All</option>
                      <option value="Beluga">Beluga</option>                   
                      <option value="Cedar">Cedar</option>  
                      <option value="Graham">Graham</option>    
                      <option value="Narval">Narval</option>                    
                      <option value="Niagara">Niagara</option>      
                      <option value="Siku">Siku</option>
                      </select>
                    </div>            
                  </div>
                </div>
              </div>

    <div class="row py-4">
            <div class="col-sm-3">
             <div class="form-group">
                 <div class="input-group">
                    <div class="input">
                       <label for="gpu" class="form-label">GPU model</label>
                       <select class="form-select mb-1 form-select-sm" style="background-color: #b7b796;" name = "gpu_model"/>
                       <option value="">All</option>
                       <option value="A100-SXM4">A100-SXM4</option>
                       <option value="P100-PCIE">P100-PCIE</option>    
                       <option value="RTX6000">RTX6000</option>       
                       <option value="T4">T4</option>                                             
                       <option value="V100">V100</option>                              
                       <option value="V100-PCIE">V100-PCIE</option>   
                       <option value="V100-SXM2">V100-SXM2</option>   
                       </select>       
                    </div>            
                </div>
            </div>
        </div>    

            <div class="col-sm-2">
             <div class="form-group">
                 <div class="input-group">
                    <div class="input">
                       <label for="cpu" class="form-label">CPU model</label>
                       <select class="form-select mb-1 form-select-sm" style="background-color: #b7b796;" name = "cpu_model"/>
                       <option value="">All</option>
                       <option value="7532">EPYC 7532</option>
                       <option value="7413">EPYC 7413</option>    
                       <option value="ES-2683">XEON ES-2683</option>       
                       <option value="E5-2650">XEON E5-2650</option>                                             
                       <option value="6248">XEON GOLD 6248</option>      
                       <option value="6148">XEON GOLD 6148</option>    
                       <option value="5120">XEON GOLD 5120</option>                                                                                   
                       <option value="4216">XEON SILVER 4216</option>                                                                                   
                       <option value="4110">XEON SILVER 4110</option>                                                                                   
                       </select>                              
                    </div>            
                </div>
            </div>
        </div>

        <div class="col-sm-2">
           <div class="form-group">
              <div class="input-group">
                 <div class="input">
                    <label for="arch" class="form-label">AVX capability</label>
                    <select class="form-select mb-1 form-select-sm" style="background-color: #b7b796;" name = "arch" placeholder="avx2 .."/>
                    <option value="">All</option>
                    <option value="avx2">AVX-2</option>
                    <option value="avx512">AVX-512</option>       
                    </select>                     
                 </div>            
              </div>
           </div>
        </div>

        <div class="col-sm-3">
            <div class="form-group">
                <div class="input-group">
                    <div class="input">
                        <label for="dataset" class="form-label">Simulation system</label>
                        <select class="form-select mb-1 form-select-sm" style="background-color: #b7b796;" name = "dataset" placeholder="6n4o .."/>
                        <option value="6n4o">PDB ID: 6n4o</option>
                        <option value="4cg1">PDB ID: 4cg1</option>                        
                        </select>
                    </div>            
                </div>
            </div>
        </div>
        <div class="col-sm-2"></div> 

        <div class="row my-4">
              <div class="d-flex justify-content-center">
                     <button class="btn btn-sm btn-outline-light mx-2" type="submit">Search <i class="fa fa-search"></i></button>
                     <button class="btn btn-sm btn-outline-light mx-2" type=button onClick="javascript:history.go(-1);"> Back</button>                      
              {{ csv_file }}
              </div>

        <div class="row mt-4">
              <div class="d-flex justify-content-center">
                 <div style="color: #85b737;" >APPLIED FILTERS: {{querystr}}</div>
                 <button class="btn btn-sm btn-outline-light px-2 mx-4" type="button" onclick="location.href='{% url 'export' %}'">Download csv</button>.
              </div>
        </div>
      </div>

      </form>
    </div>
  </div>
</div>
</div>
{% endblock content%}

{% block content2%}
<div class="row gx-0" style="background-color: #eee;">
  <div class="col-sm-4">
    <div class="d-flex justify-content-center pt-3">
      <div class="card border-0" style="background-color: #eee;">
        <div class="card-body">
            <h3 class="card-title">ACCESSING THE DATABASE</h3>
              <div class="card-text">
                </p>When this page is viewed no filters are initially applied. All benchmarks are selected and sorted by simulation speed. The chart on the right displays only top 20 benchmarks for clarity.</p>  
                <p>A subset of benchmarks can be selected using a custom chain of filters. Search fields are case insensitive and can be abbreviated.</p>
                <p> Selected database entries can be downloaded as CSV files for further analysis or viewed in the Table below.</p>
                <p> Efficiency = PS/(SS * N) where PS is speed of the parallel program, SS is speed of the serial program, and N is the number of CPUs or GPUs<p>               
             </div>   
         </div>
      </div>
    </div>
  </div>

  <div class="col-sm-8">
    <div class="d-flex justify-content-center pt-3">
      <div class="card border-0" style="background-color: #eee;" >
        <div class="card-body">
          <h3 class="card-title">Performance</h3>
            <div class="card-img-top">
              {% autoescape off %} {{ plot_div }} {% endautoescape %}
            </div>
        </div>
      </div>
    </div>  
  </div>
</div>

<div class="row gx-0" style="background-color: #fff">
  <div class="col-sm-8"> 
    <div style="background-color: #fff">
        <div class="d-flex justify-content-center pt-3">
            <div class="card border-0" style="background-color: #fff;" >
              <div class="card-body">
                <h3 class="card-title" style="color: #B79754;">Cost of Simulations Using GPUs</h3>
                  <div class="card-img-top">
                    {% autoescape off %} {{ plot_div_cost_gpu }} {% endautoescape %}
                  </div>
              </div>
            </div>
        </div>
   </div>
</div>

  <div class="col-sm-4">
    <div class="container-fluid pt-3">
      <div class="row justify-content-center">
        <div class="col-auto" >
          <div class="card border-0" style="background-color: #fff;">
            <div class="card-body">
                <h3 class="card-title" style="color: #B79754;">SIMULATIONS ON MULTIPLE GPUS</h3>
               <div class="card-text">
                </p>Parallel scaling to multiple GPUs strongly depends on the compibation of software, hardware and simulation parameters. Often simulations do not run faster even on two GPUs. For example, search for namd2.cuda in "Software name" and Cedar in "Cluster".</p>  
                <p> Simulations on nodes with direct interconnect between GPUs (NVLink) may benefit from multiple GPUs, but efficiency decreases and cost goes up with the number of GPUs. Example: pmemd.cuda, narval</p>
               </div>   
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row gx-0" style="background-color: #eee">
  <div class="col-sm-4">
      <div class="d-flex justify-content-center pt-3">
          <div class="card border-0" style="background-color: #eee;">
            <div class="card-body">
                <h4 class="card-title" style="color: #B79754;">SIMULATIONS ON MULTIPLE CPUS</h4>
               <div class="card-text">
                </p>Simulations using CPUs reach performance comparable to GPU only with hundreds of cores used. It is not uncommon for simulations to wait in the queue for up to several days for such a significant resource to be available.</p>  
               </div>   
            </div>
          </div>
      </div>
  </div>

  <div class="col-sm-8">
    <div style="background-color: #eee">
        <div class="d-flex justify-content-center pt-3">
            <div class="card border-0" style="background-color: #eee" >
              <div class="card-body">
                <h3 class="card-title" style="color: #B79754;">Cost of Simulations Using CPUs</h3>
                  <div class="card-img-top">
                    {% autoescape off %}
                    {{ plot_div_cost_cpu }}
                    {% endautoescape %}
                  </div>
              </div>
            </div>
        </div>
    </div>
  </div>
</div>

<div style="background-color:  #222529">
  <div class="d-flex justify-content-center pt-3">
      <div class="card" style="background-color: #35754c;">
          <div class="card-body">
              <div class="card-title"><h3>BENCHMARK DETAILS</h3>
                    <button class="btn btn-sm btn-outline-light"><a style="color: #aaa" href="{% url 'export' %}">Download CSV</a></button>
              </div>
              {{ csv_file }}
              <div style="background-color: #eee;">
                <table class="table table-hover">
                  {% include "mdbench/t_head.html" %}
                  {% for benchmark in queryset %}
                    <tr>
                      {% include "mdbench/t_data.html" %}
                    </tr>   
                  {% endfor %} 
                  </table>
              </div>   
          </div>
      </div>
  </div>
</div>

{% endblock %}

